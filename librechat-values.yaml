# OpenShift compatibility - OpenShift assigns UIDs automatically
# Main LibreChat app - must explicitly set these to empty/false
podSecurityContext:
  fsGroup: null

securityContext:
  capabilities:
    drop:
    - ALL
  runAsNonRoot: false
  runAsUser: null

# Environment variables for LibreChat
librechat:
  # Custom librechat.yaml configuration
  # https://www.librechat.ai/docs/configuration/librechat_yaml
  configYamlContent: |-
    version: 1.0.8
    cache: true

    # Custom OpenAI-compatible endpoints
    # https://www.librechat.ai/docs/configuration/librechat_yaml/object_structure/custom_endpoint
    endpoints:
      custom:
        - name: "Granite"
          apiKey: "${CUSTOM_API_KEY}"
          baseURL: "https://litellm-prod.apps.maas.redhatworkshops.io"
          models:
            default:
              - "granite-8b-code-instruct-128k"
            fetch: true
          titleConvo: false
          summarize: false
          forcePrompt: false
          modelDisplayLabel: "Granite Code 8B"
          dropParams:
            - "user"
            - "frequency_penalty"
            - "presence_penalty"

  configEnv:
    ALLOW_REGISTRATION: "true"
    ALLOW_EMAIL_LOGIN: "true"

# Configure ingress for OpenShift route
ingress:
  enabled: true
  hosts:
    - host: librechat-librechat.apps.cluster-rmvld.dynamic.redhatworkshops.io
      paths:
        - path: /
          pathType: ImplementationSpecific

# Add writable volumes for logs (multiple locations)
volumes:
  - name: logs
    emptyDir: {}
  - name: logs-root
    emptyDir: {}

volumeMounts:
  - name: logs
    mountPath: /app/api/logs
  - name: logs-root
    mountPath: /app/logs

# Global OpenShift compatibility for MongoDB
global:
  compatibility:
    openshift:
      adaptSecurityContext: force

# MongoDB configuration
# IMPORTANT: As of August 2025, Bitnami only provides "latest" tag in free tier
# Current version running: MongoDB 8.2.2
# Options for pinning versions:
#   1. Use image digest (recommended): docker.io/bitnami/mongodb@sha256:xxxxx
#   2. Use Bitnami Legacy repo: docker.io/bitnamilegacy/mongodb:8.0-debian-12
#   3. Use official MongoDB image: docker.io/mongo:8.2.2 (requires different config)
mongodb:
  image:
    tag: "latest"
    # To pin to current version (MongoDB 8.2.2), uncomment the line below and comment out tag:
    # digest: "sha256:219bea2e10ac98619a0a2edbce0c5119635ffd2518852cd75c77da234e610327"
  global:
    compatibility:
      openshift:
        adaptSecurityContext: force

# Meilisearch configuration - override all security contexts
meilisearch:
  podSecurityContext:
    runAsNonRoot: false
    runAsUser: null
    runAsGroup: null
    fsGroup: null
    fsGroupChangePolicy: null
  securityContext: {}

# Auto-create default user on deployment
# Set to true to enable automatic user creation
createDefaultUser:
  enabled: true  # Change to true to enable
  # User credentials are pulled from librechat-credentials-env secret:
  # - DEFAULT_USER_EMAIL
  # - DEFAULT_USER_PASSWORD
  # - DEFAULT_USER_NAME
